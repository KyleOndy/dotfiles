#! /usr/bin/env nix-shell
# shellcheck shell=bash
#! nix-shell -i bash -p rsync python3 ffmpeg yt-dlp
# vi: ft=bash
#set -e # script will bail when a channel has a premeier

common_args=(
    # todo: XDG data
    --download-archive "$HOME/.yt-dl/youtube-dl-seen.conf"
    --prefer-free-formats
    --ignore-errors
    --mark-watched
    --embed-subs
    --add-metadata
    --concurrent-fragments=20
    --compat-options no-live-chat
    --match-filter "!is_live"
    # todo: XDG data
    --output "$HOME/.yt-dl/downloads/%(uploader)s/%(upload_date)s - %(uploader)s - %(title)s [%(id)s].%(ext)s"
)

download_args=(
    --playlist-end 25 \
)

archive_args=(
    # TODO: bump this up higer
    --playlist-end 75 \
)

download() {
  echo "==> Downloading $1"
  yt-dlp "https://www.youtube.com/$1" "${common_args[@]}" "${download_args[@]}"
}

archive() {
  # todo: don't download twice
  echo "==> Archiving $1"
  yt-dlp "https://www.youtube.com/$1" "${common_args[@]}" "${archive_args[@]}"
}


download_all() {


  ## cycling
  download "c/DylanJohnsonCycling/videos"             # Dylan Johnson
  download "c/PhilGaimonshow/videos"                  # Phil Gaimon
  download "c/TheVeganCyclist/videos"                 # The Vegan Cyclist
  download "channel/UCFlT34jR2eye2OfAA48enMQ/videos"  # Valley Preferred Cycling Center
  download "user/sportscientist/videos"               # Stephen Seiler
  archive  "channel/UCEiB7dUaQJfVkAIpVY2fiwA/videos"  # black line coaching
  download "c/DannyMacAskill/videos"                  # Danny MacAskill
  download "c/cosmocatalano-howtheracewaswon/videos"  # How the race was won
  download "c/JoyOfBike/videos"                       # joy of bikes
  download "/@chadweberg1/videos"                     # Chad Weberg
  download "@DirtyTeethMTB/videos"                    # "Dirty Teeth MTB"
  download "@jasperverkuijl/videos"                   # "Jasper Verkuijl"
  download "@nerocoaching/videos"                     # "Jesse Coyle"
  download "@joe.nation/videos"                       # "Joe Nation"
  download "@joshibbett/videos"                       # "josh ibbett"
  download "@sofianeshl/videos"                       # "Sofiane Sehili"
  download "@TENTISTHENEWRENT/videos"                 # "TENT IS THE NEW RENT"

  ## science
  #archive "c/3blue1brown/videos"            # 3Blue1Brown
  download "c/3blue1brown/videos"            # 3Blue1Brown
  download "c/halfasinteresting/videos"     # Half As Interesting
  download "c/Wendoverproductions/videos"   # Wendover Productions

  ## maker
  download "c/tested/videos"                    # Adam Savageâ€™s Tested
  download "c/StuffMadeHere/videos"             # Stuff Made Here
  download "/c/StuffMadeHere2/videos"           # Stuff Made Here 2

  # entertainment
  archive  "c/kaptainkristian/videos"     # kaptainkristian
  archive "c/everyframeapainting/videos"
  archive "c/smartereveryday/videos"
  archive "c/PracticalEngineeringChannel/videos"
  download "c/SampsonBoatCo/videos"                   # Sampson Boat Co
  download "c/ShubaMusic/videos"
  download "@GxAce/videos"              # "GxAce"

  # tech
  download "c/AdamJames-tv/videos"            # Adam James (Clojure)
  download "user/ClojureTV/videos"            # clojureTv
  download "c/Tsoding/videos"                         # Tsoding
  download "c/tutoriaLinux/videos"                    # tutoriaLinux
  archive  "c/KRAZAM/videos"                          # KRAZAM
}

download_all
