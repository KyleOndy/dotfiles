#! /usr/bin/env nix-shell
# shellcheck shell=bash
#! nix-shell -i bashInteractive -p makemkv
# vi: ft=bash

# Source common library
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
# shellcheck source=../lib/common.sh
source "${SCRIPT_DIR}/../lib/common.sh"

set_strict_mode

main() {
  if [[ $# -ne 1 ]]; then
    die "usage: $0 <out_dir>"
  fi
  local out_dir=$1

  log_info "Loading kernel module sg..."
  sudo modprobe sg

  log_info "Creating output directory: $out_dir"
  mkdir -p "$out_dir"

  log_info "Starting MakeMKV to copy disc..."
  makemkvcon --robot mkv disc:0 all "$out_dir"

  log_info "DVD copy complete!"
}

main "$@"
