{
  "_id": "nixos-audio-normalization",
  "name": "Audio Normalization - AAC + Subtitle Cleanup",
  "description": "Preserve original video codec. Add AAC audio tracks for device compatibility (iOS/web). Remove PGS/DVD subtitles that cannot direct-stream. Standardize on MKV container.",
  "tags": "audio,aac,compatibility,mkv,subtitle-cleanup",
  "flowPlugins": [
    {
      "name": "Input File",
      "sourceRepo": "Community",
      "pluginName": "inputFile",
      "version": "1.0.0",
      "id": "input001",
      "position": { "x": 400, "y": 100 }
    },
    {
      "name": "FFmpeg Start",
      "sourceRepo": "Community",
      "pluginName": "ffmpegCommandStart",
      "version": "1.0.0",
      "id": "ffstart1",
      "position": { "x": 400, "y": 200 }
    },
    {
      "name": "Remove PGS/DVD Subtitles",
      "sourceRepo": "Community",
      "pluginName": "ffmpegCommandRemoveStreamByProperty",
      "version": "1.0.0",
      "id": "rempgs01",
      "position": { "x": 400, "y": 300 },
      "inputsDB": {
        "propertyToCheck": "codec_name",
        "valuesToRemove": "hdmv_pgs_subtitle,dvd_subtitle",
        "condition": "include"
      }
    },
    {
      "name": "Set Container MKV",
      "sourceRepo": "Community",
      "pluginName": "ffmpegCommandSetContainer",
      "version": "1.0.0",
      "id": "setcont1",
      "position": { "x": 400, "y": 400 },
      "inputsDB": {
        "container": "mkv"
      }
    },
    {
      "name": "Check for EAC3 Audio",
      "sourceRepo": "Community",
      "pluginName": "checkAudioCodec",
      "version": "1.0.0",
      "id": "chkeac3-1",
      "position": { "x": 400, "y": 500 },
      "inputsDB": {
        "codecs": "eac3"
      }
    },
    {
      "name": "Add AAC 5.1 from EAC3",
      "sourceRepo": "Community",
      "pluginName": "ffmpegCommandEnsureAudioStream",
      "version": "1.0.0",
      "id": "addaac51-1",
      "position": { "x": 300, "y": 600 },
      "inputsDB": {
        "audioCodec": "aac",
        "audioChannels": "6",
        "audioBitrate": "384k"
      }
    },
    {
      "name": "Ensure AAC Stereo Fallback",
      "sourceRepo": "Community",
      "pluginName": "ffmpegCommandEnsureAudioStream",
      "version": "1.0.0",
      "id": "ensaac1",
      "position": { "x": 500, "y": 600 },
      "inputsDB": {
        "audioCodec": "aac",
        "audioChannels": "2",
        "audioBitrate": "192k"
      }
    },
    {
      "name": "Execute FFmpeg",
      "sourceRepo": "Community",
      "pluginName": "ffmpegCommandExecute",
      "version": "1.0.0",
      "id": "ffexec1",
      "position": { "x": 400, "y": 700 }
    },
    {
      "name": "Replace Original File",
      "sourceRepo": "Community",
      "pluginName": "replaceOriginalFile",
      "version": "1.0.0",
      "id": "replace1",
      "position": { "x": 400, "y": 800 }
    }
  ],
  "flowEdges": [
    {
      "source": "input001",
      "sourceHandle": "1",
      "target": "ffstart1",
      "targetHandle": null,
      "id": "e001"
    },
    {
      "source": "ffstart1",
      "sourceHandle": "1",
      "target": "rempgs01",
      "targetHandle": null,
      "id": "e002"
    },
    {
      "source": "rempgs01",
      "sourceHandle": "1",
      "target": "setcont1",
      "targetHandle": null,
      "id": "e003"
    },
    {
      "source": "setcont1",
      "sourceHandle": "1",
      "target": "chkeac3-1",
      "targetHandle": null,
      "id": "e004"
    },
    {
      "source": "chkeac3-1",
      "sourceHandle": "1",
      "target": "addaac51-1",
      "targetHandle": null,
      "id": "e005",
      "comment": "EAC3 found - add 5.1 AAC track"
    },
    {
      "source": "chkeac3-1",
      "sourceHandle": "2",
      "target": "ensaac1",
      "targetHandle": null,
      "id": "e006",
      "comment": "No EAC3 - ensure stereo AAC exists"
    },
    {
      "source": "addaac51-1",
      "sourceHandle": "1",
      "target": "ffexec1",
      "targetHandle": null,
      "id": "e007"
    },
    {
      "source": "ensaac1",
      "sourceHandle": "1",
      "target": "ffexec1",
      "targetHandle": null,
      "id": "e008"
    },
    {
      "source": "ffexec1",
      "sourceHandle": "1",
      "target": "replace1",
      "targetHandle": null,
      "id": "e009"
    }
  ]
}
